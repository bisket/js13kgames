<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen"> /* 여기서부터 CSS */
      @media(){ /*디바이스 크기따라 캔버스 크기 조절*/
        canvas{

        }
      }
      *{
        border: 1px solid gray; /*캔버스 크기 파악*/
        margin: auto;
      }
      canvas{
        display: block;
      }
    </style>
  </head>
  <body onload = "start()">
    <canvas id="C" width="800" height="500"></canvas>
    <script type="text/javascript"> // 여기서부터 자바스크립트

      let c = document.getElementById('C')
      let ctx = c.getContext("2d")
      window.addEventListener('keydown', function(e){
        if(e.keyCode == 68){pc.x += 5} // D키를 누르면 오른쪽으로 이동
        else if(e.keyCode == 65){pc.x -= 5} // A키를 누르면 왼쪽으로 이동
        else if(e.keyCode == 32){pc.jump()} // 스페이스바를 누르면 점프
      })

      // 캐릭터 만들기
      let pc = {
        x: 300,
        y: 250,
        jump: function(){
          for(i=0;i<20;i++){
            if(this.y<250){
              this.y += i
            } else {
              this.y -= i
            }
          }
        },
        drawing: function(){
          ctx.fillStyle = 'red';
          ctx.fillRect(this.x, this.y, 60, 80);
          ctx.fillStyle = 'PeachPuff';
          ctx.fillRect(this.x, this.y, 60, 40)
          ctx.fillStyle = 'purple'
          ctx.fillRect(this.x+10, this.y+20, 5, 10)
          ctx.fillRect(this.x+40, this.y+20, 5, 10)
          ctx.fillRect(this.x, this.y, 20, 15)
          ctx.fillRect(this.x, this.y, 60, 10)
          ctx.fillRect(this.x+25, this.y, 20, 15)
        }
      }

      // 미니맵 만들기
      let map = {
        drawing: function(){
          ctx.fillRect(0, 0, 150, 100)
        }
      }

      //퀘스트창 만들기
      let quest = {
        x: 200,
        drawing: function(){
          ctx.fillRect(c.width-this.x, 0, this.x, 100)
        }
      }

      let myPage = {
        y: 100,

        //가방 만들기
        myBag: {
          drawing: function(){
            ctx.fillStyle = 'tomato'
            ctx.fillRect(0, c.height-100, 120, 100/3)
          }
        },

        //스테이터스 만들기 (램프 시간 표시)
        myStat: {
          drawing: function(){
            let y = (100/3)*2
            ctx.fillStyle = 'salmon'
            ctx.fillRect(0, c.height-y, 120, 100/3)
          }
        },

        //기타 등등.
        etc: {
          drawing: function(){
            let y = (100/3)
            ctx.fillStyle = 'pink'
            ctx.fillRect(0, c.height-y, 120, 100/3)
          }
        },

        // 3단 그라데이션
        drawing: function(){
          ctx.fillRect(0, c.height-this.y, 120, this.y)
          this.myBag.drawing()
          this.myStat.drawing()
          this.etc.drawing()
        }
      }

      //채팅 표시 만들기
      let chat = {
        x: 680,
        y: 100,
        drawing: function(){
          ctx.fillStyle = 'lightgray'
          ctx.fillRect(c.width-this.x, c.height-this.y, this.x, this.y)
        }
      }

      //배경 만들기
      let background = {
        drawing: function(){

        }
      }
      let circle1 = {
        k: 0,
        b: 2,
        drawing1 : function(){
        ctx.beginPath();
        ctx.fillStyle = 'black'
        ctx.arc(680, 125, 15, this.k*Math.PI, this.b * Math.PI);
        ctx.stroke();ctx.beginPath();
        }
      }
      let circle2 = {
        c: 0,
        d: 2,
        drawing2 : function(){
        ctx.beginPath();
        ctx.fillStyle = 'black'
        ctx.arc(725, 125, 15, this.c* Math.PI, this.d * Math.PI);
        ctx.stroke();ctx.beginPath();
        }
      }
      let circle3 = {
        e: 0,
        f: 2,
        drawing3 : function(){
        ctx.beginPath();
        ctx.fillStyle = 'black'
        ctx.arc(770, 125, 15,this.e* Math.PI, this.f * Math.PI);
        ctx.stroke();
      }
    }
      function TimeLimit1(){
        ctx.clearRect(0,0, c.width,c.height);
        circle3.e=circle3.e+0.1;
        circle3.f=circle3.f-0.1;
        circle1.drawing1();
        circle2.drawing2();
        circle3.drawing3();
        if(circle3.e>=1 && circle3.f<=1){
          clearInterval(start1);
          //ctx.clearRect(0,0, c.width,c.height);
          circle1.drawing1();
          circle2.drawing2();
          start2 = setInterval(TimeLimit2, 500);
        }
      }
      function TimeLimit2(){
        ctx.clearRect(0,0, c.width,c.height);
        circle2.c=circle2.c+0.1;
        circle2.d=circle2.d-0.1;
        circle1.drawing1();
        circle2.drawing2();
        if(circle2.c>=1 && circle2.d<=1){
          clearInterval(start2);
          //ctx.clearRect(0,0, c.width,c.height);
          circle1.drawing1();
          start3 = setInterval(TimeLimit3, 500);
          }
      }
      function TimeLimit3(){
        ctx.clearRect(0,0, c.width,c.height);
        circle1.k=circle1.k+0.1;
        circle1.b=circle1.b-0.1;
        circle1.drawing1();
        if(circle1.k>=1 && circle1.b<=1){
          clearInterval(start3);
          alert("Time Over");
          //ctx.clearRect(0,0, c.width,c.height);
          //self.close();
        }
      }
      let start1 = setInterval(TimeLimit1, 500);
      //게임을 처음 시작할 때 설정
      function start(){
        setInterval(update, 20)
      }

      //캔버스 전체 지우고 다시 그릴 때 설정
      function update(){
        ctx.clearRect(0, 0, c.width, c.height)
        pc.drawing();
        map.drawing();
        quest.drawing();
        myPage.drawing();
        chat.drawing();
        circle1.drawing1();
        circle2.drawing2();
        circle3.drawing3();
        if(circle3.e>=0.9 && circle3.f<=1.1){
          circle3.e=1;
          circle3.f=1;}
        if(circle1.k>=0.9 && circle1.b<=1.1){
          circle1.k=1;
          circle1.b=1;}
        if(circle2.c>=0.9 && circle2.d<=1.1){
          circle2.c=1;
          circle2.d=1;}
      }
    </script>
  </body>
</html>
